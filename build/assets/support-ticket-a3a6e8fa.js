import{k as c,u as Q,c as x,r as X,b as o,d as a,e as t,m as A,F as d,A as u,h as D,w as C,z as R,J as E,t as i,l as Y}from"./app-c4a345d8.js";import{c as Z,s as m}from"./loading-8c6d7625.js";import{d as tt}from"./theme-sugar-eadf48c4.js";import{P as z}from"./Pagination-759b1122.js";const et={class:"dashboard"},st={class:"container"},lt=t("div",{class:"d-flex justify-content-between align-items-center title-button-wrapper"},[t("h2",{class:"title mb-0"},"Support Ticket")],-1),ot={class:"sub-section server-list-tab"},at={class:"row justify-content-between align-items-center"},nt={class:"row mb-5 pe-0"},it={class:"col-md-9 d-flex pe-0 flex-wrap"},ct={class:"sort-servers order-2 order-md-1"},dt=t("span",null,"Sort by",-1),rt=[dt],ut={key:0,class:"sorting-items"},pt={class:"nav nav-pills mb-3 mb-md-0 order-1 order-md-2 mb-lg-0",id:"pills-tab",role:"tablist"},vt=t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link active",id:"pills-all-tab","data-bs-toggle":"pill","data-bs-target":"#pills-all",type:"button",role:"tab","aria-controls":"pills-all","aria-selected":"true"},"All")],-1),_t=["id","data-bs-target","aria-controls"],mt={class:"col-md-3 text-end"},ht={class:"tab-content",id:"pills-tabContent"},gt={class:"tab-pane fade show active",id:"pills-all",role:"tabpanel","aria-labelledby":"pills-all-tab"},bt={class:"row mb-5"},ft={key:0},kt={class:"card-item p-4 mb-4 support-item flex-column"},yt={class:"d-flex justify-content-between support-item-header"},wt={class:"support-item-title"},xt=t("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),Ct={style:{color:"rgba(23, 30, 38, 0.5)"}},Pt={class:"detail",style:{"margin-top":"10px"}},Tt={class:"detail",style:{"margin-top":"5px"}},St={class:"support-item-status"},jt={key:0,class:"successful-cell"},$t={class:"fs-15 color-in-work"},At={key:1,class:"cancelled-cell"},Dt={class:"fs-15 color-in-work"},Lt={key:2,class:"in-progress-cell"},It={class:"fs-15 color-in-work"},Nt={class:"support-item-detail"},Ot={class:"fs-15 mb-0"},Bt={class:"w-100 server-list-pagination"},Mt=["id","aria-labelledby"],Ut={class:"row mb-5"},Vt={key:0},Ft={class:"card-item p-4 mb-4 support-item flex-column"},Rt={class:"d-flex justify-content-between support-item-header"},Et=["href"],zt={class:"support-item-title"},Gt=t("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),Jt={style:{color:"rgba(23, 30, 38, 0.5)"}},Wt={class:"detail",style:{"margin-top":"10px"}},qt={class:"detail",style:{"margin-top":"5px"}},Ht={class:"support-item-status"},Kt={key:0,class:"successful-cell"},Qt={class:"fs-15 color-in-work"},Xt={key:1,class:"cancelled-cell"},Yt={class:"fs-15 color-in-work"},Zt={key:2,class:"in-progress-cell"},te={class:"fs-15 color-in-work"},ee={class:"support-item-detail"},se={class:"fs-15 mb-0"},le={class:"w-100 server-list-pagination"},oe={key:0,class:"modal modal-ticket"},ae={class:"modal-inner"},ne=t("img",{class:"close-dark",src:"assets/img/close.svg",alt:""},null,-1),ie=t("img",{class:"close-light",src:"assets/img/close-light.svg",alt:""},null,-1),ce=[ne,ie],de={class:"modal-content"},re=t("div",{class:"modal-header"},[t("div",{class:"modal-title"},[t("h2",null,"New ticket"),t("h3",null,"Create new ticket now.")])],-1),ue={class:"modal-main"},pe={class:"amounts"},ve=t("h4",null,"Subject",-1),_e=t("h4",null,"Describe the problem",-1),me=t("h4",null,"Department*",-1),he=["value"],ge={key:0},be=t("h4",null,"Service related",-1),fe=t("option",{value:"0"},"- None -",-1),ke=["value"],ye=["disabled"],v=8,Se={__name:"support-ticket",setup(we){const L=tt.useToast(),I=Z(),h=c(!1),g=c(!1),G=Q(),J=x(()=>G.state.auth.user),p=c([]),N=c([]),P=c([]),T=c([]),S=c(0),b=c(0),f=c(""),k=c(""),O=c(0),W=c(["All","Open","Answered","Customer-Reply","Closed"]),r=c({client_id:J.value.client_id,orderby:"",order:"",page:1}),q=x(()=>{const s=(r.value.page-1)*v,l=s+v;return p.value.slice(s,l)}),B=()=>{m(!0),I.runGetApi("/support-ticket",r.value).then(s=>{m(!1),h.value=!1,console.log(s.data),p.value=s.data.tickets;const l=x(()=>{var e,n;return(n=(e=s==null?void 0:s.data)==null?void 0:e.status)==null?void 0:n.filter(K=>W.value.includes(K.title))});T.value=l.value,N.value=s.data.departments,P.value=s.data.orders;const _=s.data.totalTickets;O.value=Math.ceil(_/v)}).catch(s=>{console.log(s)})};B();function y(s){return new Date(s).toISOString().slice(0,10)}function M(s){r.value.page=s}function j(s){return`pills-${V(s)}`}function U(s){return`pills-${V(s)}-tab`}function V(s){return s.toLowerCase().replace(/ /g,"-")}const F=c([]);function $(s){const l=p.value.filter(e=>e.status===s),_=x(()=>{const e=(r.value.page-1)*v,n=e+v;return l.slice(e,n)});return F.value[s]=Math.ceil(l.length/v),_.value}function w(s,l){r.value.orderby=s,r.value.order=l,B()}const H=()=>{m(!0),I.runPostApi("/ticket-create",{subject:f.value,message:k.value,department:b.value,message:k.value,service:S.value}).then(s=>{m(!1),s.data.result=="success"?(p.value=s.data.tickets,L.success("Successfully opened ticket!"),g.value=!1):L.warning("Cannot connect to whmcs api.")}).catch(s=>{m(!1),console.log(s)})};return(s,l)=>{const _=X("router-link");return o(),a(d,null,[t("section",et,[t("div",st,[lt,t("div",ot,[t("div",at,[t("div",nt,[t("div",it,[t("div",ct,[t("div",{id:"toggleButton",class:"sort-item-active btn-chevron chevron-dark",style:{width:"160px"},onClick:l[0]||(l[0]=e=>h.value=!h.value)},rt),h.value?(o(),a("div",ut,[t("ul",null,[t("li",{class:"touch-item",onClick:l[1]||(l[1]=e=>w("date","desc"))},"Opened-latest"),t("li",{class:"touch-item",onClick:l[2]||(l[2]=e=>w("date","asc"))},"Opened-oldest"),t("li",{class:"touch-item",onClick:l[3]||(l[3]=e=>w("lastreply","desc"))},"Last-Reply-latest"),t("li",{class:"touch-item",onClick:l[4]||(l[4]=e=>w("date","asc"))},"Last-Reply-oldest")])])):A("",!0)]),t("ul",pt,[vt,(o(!0),a(d,null,u(T.value,e=>(o(),a("li",{key:e.title,class:"nav-item",role:"presentation"},[t("button",{id:U(e.title),class:"nav-link","data-bs-toggle":"pill","data-bs-target":"#"+j(e.title),type:"button",role:"tab","aria-controls":j(e.title),"aria-selected":!1},i(e.title),9,_t)]))),128))])]),t("div",mt,[t("button",{type:"submit",class:"btn btn-dark hover-dark-light d-inline",id:"create-ticket",onClick:l[5]||(l[5]=e=>g.value=!0)},"Create Ticket")])]),t("div",ht,[t("div",gt,[t("div",bt,[!p.value||p.value.length===0?(o(),a("h5",ft,"No tickets found")):(o(!0),a(d,{key:1},u(q.value,e=>(o(),a("div",{key:e.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[t("div",kt,[t("div",yt,[D(_,{to:{name:"ticket-detail",params:{id:e.id}}},{default:Y(()=>[t("div",wt,[xt,t("span",Ct," Ticket#"+i(e.tid),1)]),t("h3",Pt," Opened at : "+i(y(e.date)),1),t("h3",Tt," Last reply at : "+i(y(e.lastreply)),1)]),_:2},1032,["to"]),t("div",St,[e.status==="Answered"?(o(),a("div",jt,[t("span",$t,i(e.status),1)])):e.status==="Closed"?(o(),a("div",At,[t("span",Dt,i(e.status),1)])):(o(),a("div",Lt,[t("span",It,i(e.status),1)]))])]),t("div",Nt,[t("p",Ot,i(e.subject),1)])])]))),128))]),t("div",Bt,[D(z,{currentPage:r.value.page,totalPages:O.value,onPageChanged:M},null,8,["currentPage","totalPages"])])]),(o(!0),a(d,null,u(T.value,e=>(o(),a("div",{key:e.title,class:"tab-pane fade",id:j(e.title),"aria-labelledby":U(e.title)},[t("div",Ut,[!$(e.title)||$(e.title).length===0?(o(),a("h5",Vt,"No tickets found")):(o(!0),a(d,{key:1},u($(e.title),n=>(o(),a("div",{key:n.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[t("div",Ft,[t("div",Rt,[t("a",{href:"/ticket-detail/"+n.id},[t("div",zt,[Gt,t("span",Jt,"Ticket#"+i(n.tid),1)]),t("h3",Wt," Opened at : "+i(y(n.date)),1),t("h3",qt," Last reply at : "+i(y(n.lastreply)),1)],8,Et),t("div",Ht,[n.status==="Answered"?(o(),a("div",Kt,[t("span",Qt,i(n.status),1)])):n.status==="Closed"?(o(),a("div",Xt,[t("span",Yt,i(n.status),1)])):(o(),a("div",Zt,[t("span",te,i(n.status),1)]))])]),t("div",ee,[t("p",se,i(n.subject),1)])])]))),128))]),t("div",le,[D(z,{currentPage:r.value.page,totalPages:F.value[e.title],onPageChanged:M},null,8,["currentPage","totalPages"])])],8,Mt))),128))])])])])]),g.value?(o(),a("div",oe,[t("div",ae,[t("div",{class:"modal-close",onClick:l[6]||(l[6]=e=>g.value=!1)},ce),t("div",de,[re,t("div",ue,[t("div",pe,[ve,C(t("input",{class:"mb-3",name:"subject",type:"text",placeholder:"Write subject","onUpdate:modelValue":l[7]||(l[7]=e=>f.value=e)},null,512),[[R,f.value]]),_e,C(t("textarea",{class:"mb-3",name:"message",id:"",cols:"30",rows:"8","onUpdate:modelValue":l[8]||(l[8]=e=>k.value=e)},null,512),[[R,k.value]]),me,C(t("select",{name:"department",id:"department","onUpdate:modelValue":l[9]||(l[9]=e=>b.value=e)},[(o(!0),a(d,null,u(N.value,e=>(o(),a("option",{value:e.id,key:e.id},i(e.name),9,he))),128))],512),[[E,b.value]]),P.value.length>0?(o(),a("div",ge,[be,C(t("select",{name:"service",id:"service","onUpdate:modelValue":l[10]||(l[10]=e=>S.value=e)},[fe,(o(!0),a(d,null,u(P.value,e=>(o(),a(d,null,[(o(!0),a(d,null,u(e.lineitems.lineitem,n=>(o(),a("option",{key:n.relid,value:n.relid},i(n.product)+" - "+i(n.status),9,ke))),128))],64))),256))],512),[[E,S.value]])])):A("",!0),t("button",{class:"btn-dark d-block w-100 mt-5",id:"open-ticket",disabled:f.value==""||b.value==0,onClick:l[11]||(l[11]=e=>H())},"Create Ticket",8,ye)])])])])])):A("",!0)],64)}}};export{Se as default};
