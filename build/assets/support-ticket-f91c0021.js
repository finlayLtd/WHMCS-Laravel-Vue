import{_ as K,b as a,d as o,e,n as O,F as r,A as _,t as i,k as c,u as Q,c as z,r as X,m as B,h as E,w as S,z as F,J as G,l as Y}from"./app-1c59e5b4.js";import{c as Z,s as k}from"./loading-f6678eee.js";import{d as ee}from"./theme-sugar-6744922a.js";const te={props:{currentPage:Number,totalPages:Number},methods:{changePage(m){m>=1&&m<=this.totalPages&&this.$emit("page-changed",m)}}},se={"aria-label":"Page navigation"},le={class:"pagination"},ae=["onClick"];function oe(m,v,d,h,g,b){return a(),o("nav",se,[e("ul",le,[e("li",{class:O(["page-item",{disabled:d.currentPage===1}])},[e("a",{class:"page-link",href:"#",onClick:v[0]||(v[0]=u=>b.changePage(d.currentPage-1))},"Previous")],2),(a(!0),o(r,null,_(d.totalPages,u=>(a(),o("li",{key:u,class:O(["page-item",{active:d.currentPage===u}])},[e("a",{class:"page-link",href:"#",onClick:p=>b.changePage(u)},i(u),9,ae)],2))),128)),e("li",{class:O(["page-item",{disabled:d.currentPage===d.totalPages}])},[e("a",{class:"page-link",href:"#",onClick:v[1]||(v[1]=u=>b.changePage(d.currentPage+1))},"Next")],2)])])}const ne=K(te,[["render",oe]]),ie={class:"dashboard"},ce={class:"container"},de=e("div",{class:"d-flex justify-content-between align-items-center title-button-wrapper"},[e("h2",{class:"title mb-0"},"Support Ticket")],-1),re={class:"sub-section server-list-tab"},ue={class:"row justify-content-between align-items-center"},_e={class:"row mb-5 pe-0"},ve={class:"col-md-9 d-flex pe-0 flex-wrap"},pe={class:"sort-servers order-2 order-md-1"},me=e("span",null,"Sort by",-1),he=[me],ge={key:0,class:"sorting-items"},be={class:"nav nav-pills mb-3 mb-md-0 order-1 order-md-2 mb-lg-0",id:"pills-tab",role:"tablist"},fe=e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"pills-all-tab","data-bs-toggle":"pill","data-bs-target":"#pills-all",type:"button",role:"tab","aria-controls":"pills-all","aria-selected":"true"},"All")],-1),ke=["id","data-bs-target","aria-controls"],ye={class:"col-md-3 text-end"},we={class:"tab-content",id:"pills-tabContent"},Ce={class:"tab-pane fade show active",id:"pills-all",role:"tabpanel","aria-labelledby":"pills-all-tab"},Pe={class:"row mb-5"},xe={key:0},Se={class:"card-item p-4 mb-4 support-item flex-column"},Te={class:"d-flex justify-content-between support-item-header"},$e={class:"support-item-title"},je=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),Ae={style:{color:"rgba(23, 30, 38, 0.5)"}},Ne={class:"detail",style:{"margin-top":"10px"}},De={class:"detail",style:{"margin-top":"5px"}},Le={class:"support-item-status"},Oe={key:0,class:"successful-cell"},Be={class:"fs-15 color-in-work"},Me={key:1,class:"cancelled-cell"},Ue={class:"fs-15 color-in-work"},Ve={key:2,class:"in-progress-cell"},Ie={class:"fs-15 color-in-work"},Re={class:"support-item-detail"},ze={class:"fs-15 mb-0"},Ee=["id","aria-labelledby"],Fe={class:"row mb-5"},Ge={key:0},Je={class:"card-item p-4 mb-4 support-item flex-column"},We={class:"d-flex justify-content-between support-item-header"},qe=["href"],He={class:"support-item-title"},Ke=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),Qe={style:{color:"rgba(23, 30, 38, 0.5)"}},Xe={class:"detail",style:{"margin-top":"10px"}},Ye={class:"detail",style:{"margin-top":"5px"}},Ze={class:"support-item-status"},et={key:0,class:"successful-cell"},tt={class:"fs-15 color-in-work"},st={key:1,class:"cancelled-cell"},lt={class:"fs-15 color-in-work"},at={key:2,class:"in-progress-cell"},ot={class:"fs-15 color-in-work"},nt={class:"support-item-detail"},it={class:"fs-15 mb-0"},ct={key:0,class:"modal modal-ticket"},dt={class:"modal-inner"},rt=e("img",{class:"close-dark",src:"assets/img/close.svg",alt:""},null,-1),ut=e("img",{class:"close-light",src:"assets/img/close-light.svg",alt:""},null,-1),_t=[rt,ut],vt={class:"modal-content"},pt=e("div",{class:"modal-header"},[e("div",{class:"modal-title"},[e("h2",null,"New ticket"),e("h3",null,"Create new ticket now.")])],-1),mt={class:"modal-main"},ht={class:"amounts"},gt=e("h4",null,"Subject",-1),bt=e("h4",null,"Describe the problem",-1),ft=e("h4",null,"Department*",-1),kt=["value"],yt={key:0},wt=e("h4",null,"Service related",-1),Ct=e("option",{value:"0"},"- None -",-1),Pt=["value"],xt=["disabled"],jt={__name:"support-ticket",setup(m){const v=ee.useToast(),d=Z(),h=c(!1),g=c(!1),b=Q(),u=z(()=>b.state.auth.user),p=c([]),M=c([]),T=c([]),$=c([]),j=c(0),y=c(0),w=c(""),C=c(""),U=c(0),J=c(["All","Open","Answered","Customer-Reply","Closed"]),f=c({client_id:u.value.client_id,orderby:"",order:"",page:1}),A=()=>{k(!0),d.runGetApi("/support-ticket",f.value).then(s=>{k(!1),h.value=!1,console.log(s.data),p.value=s.data.tickets;const l=z(()=>{var n,R;return(R=(n=s==null?void 0:s.data)==null?void 0:n.status)==null?void 0:R.filter(H=>J.value.includes(H.title))});console.log("filteredStatus",l.value),$.value=l.value,M.value=s.data.departments,T.value=s.data.orders;const L=s.data.totalTickets,t=s.data.perPage;U.value=Math.ceil(L/t)}).catch(s=>{console.log(s)})};A();function P(s){return new Date(s).toISOString().slice(0,10)}function W(s){f.value.page=s,A()}function N(s){return`pills-${I(s)}`}function V(s){return`pills-${I(s)}-tab`}function I(s){return s.toLowerCase().replace(/ /g,"-")}function D(s){return p.value.filter(l=>l.status===s)}function x(s,l){f.value.orderby=s,f.value.order=l,A()}const q=()=>{k(!0),d.runPostApi("/ticket-create",{subject:w.value,message:C.value,department:y.value,message:C.value,service:j.value}).then(s=>{k(!1),s.data.result=="success"?(p.value=s.data.tickets,v.success("Successfully opened ticket!"),g.value=!1):v.warning("Cannot connect to whmcs api.")}).catch(s=>{k(!1),console.log(s)})};return(s,l)=>{const L=X("router-link");return a(),o(r,null,[e("section",ie,[e("div",ce,[de,e("div",re,[e("div",ue,[e("div",_e,[e("div",ve,[e("div",pe,[e("div",{id:"toggleButton",class:"sort-item-active btn-chevron chevron-dark",style:{width:"160px"},onClick:l[0]||(l[0]=t=>h.value=!h.value)},he),h.value?(a(),o("div",ge,[e("ul",null,[e("li",{class:"touch-item",onClick:l[1]||(l[1]=t=>x("date","desc"))},"Opened-latest"),e("li",{class:"touch-item",onClick:l[2]||(l[2]=t=>x("date","asc"))},"Opened-oldest"),e("li",{class:"touch-item",onClick:l[3]||(l[3]=t=>x("lastreply","desc"))},"Last-Reply-latest"),e("li",{class:"touch-item",onClick:l[4]||(l[4]=t=>x("date","asc"))},"Last-Reply-oldest")])])):B("",!0)]),e("ul",be,[fe,(a(!0),o(r,null,_($.value,t=>(a(),o("li",{key:t.title,class:"nav-item",role:"presentation"},[e("button",{id:V(t.title),class:"nav-link","data-bs-toggle":"pill","data-bs-target":"#"+N(t.title),type:"button",role:"tab","aria-controls":N(t.title),"aria-selected":!1},i(t.title),9,ke)]))),128))])]),e("div",ye,[e("button",{type:"submit",class:"btn btn-dark hover-dark-light d-inline",id:"create-ticket",onClick:l[5]||(l[5]=t=>g.value=!0)},"Create Ticket")])]),e("div",we,[e("div",Ce,[e("div",Pe,[!p.value||p.value.length===0?(a(),o("h5",xe,"No tickets found")):(a(!0),o(r,{key:1},_(p.value,t=>(a(),o("div",{key:t.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",Se,[e("div",Te,[E(L,{to:{name:"ticket-detail",params:{id:t.id}}},{default:Y(()=>[e("div",$e,[je,e("span",Ae," Ticket#"+i(t.tid),1)]),e("h3",Ne," Opened at : "+i(P(t.date)),1),e("h3",De," Last reply at : "+i(P(t.lastreply)),1)]),_:2},1032,["to"]),e("div",Le,[t.status==="Answered"?(a(),o("div",Oe,[e("span",Be,i(t.status),1)])):t.status==="Closed"?(a(),o("div",Me,[e("span",Ue,i(t.status),1)])):(a(),o("div",Ve,[e("span",Ie,i(t.status),1)]))])]),e("div",Re,[e("p",ze,i(t.subject),1)])])]))),128))]),E(ne,{currentPage:f.value.page,totalPages:U.value,onPageChanged:W},null,8,["currentPage","totalPages"])]),(a(!0),o(r,null,_($.value,t=>(a(),o("div",{key:t.title,class:"tab-pane fade",id:N(t.title),"aria-labelledby":V(t.title)},[e("div",Fe,[!D(t.title)||D(t.title).length===0?(a(),o("h5",Ge,"No tickets found")):(a(!0),o(r,{key:1},_(D(t.title),n=>(a(),o("div",{key:n.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",Je,[e("div",We,[e("a",{href:"/ticket-detail/"+n.id},[e("div",He,[Ke,e("span",Qe,"Ticket#"+i(n.tid),1)]),e("h3",Xe," Opened at : "+i(P(n.date)),1),e("h3",Ye," Last reply at : "+i(P(n.lastreply)),1)],8,qe),e("div",Ze,[n.status==="Answered"?(a(),o("div",et,[e("span",tt,i(n.status),1)])):n.status==="Closed"?(a(),o("div",st,[e("span",lt,i(n.status),1)])):(a(),o("div",at,[e("span",ot,i(n.status),1)]))])]),e("div",nt,[e("p",it,i(n.subject),1)])])]))),128))])],8,Ee))),128))])])])])]),g.value?(a(),o("div",ct,[e("div",dt,[e("div",{class:"modal-close",onClick:l[6]||(l[6]=t=>g.value=!1)},_t),e("div",vt,[pt,e("div",mt,[e("div",ht,[gt,S(e("input",{class:"mb-3",name:"subject",type:"text",placeholder:"Write subject","onUpdate:modelValue":l[7]||(l[7]=t=>w.value=t)},null,512),[[F,w.value]]),bt,S(e("textarea",{class:"mb-3",name:"message",id:"",cols:"30",rows:"8","onUpdate:modelValue":l[8]||(l[8]=t=>C.value=t)},null,512),[[F,C.value]]),ft,S(e("select",{name:"department",id:"department","onUpdate:modelValue":l[9]||(l[9]=t=>y.value=t)},[(a(!0),o(r,null,_(M.value,t=>(a(),o("option",{value:t.id,key:t.id},i(t.name),9,kt))),128))],512),[[G,y.value]]),T.value.length>0?(a(),o("div",yt,[wt,S(e("select",{name:"service",id:"service","onUpdate:modelValue":l[10]||(l[10]=t=>j.value=t)},[Ct,(a(!0),o(r,null,_(T.value,t=>(a(),o(r,null,[(a(!0),o(r,null,_(t.lineitems.lineitem,n=>(a(),o("option",{key:n.relid,value:n.relid},i(n.product)+" - "+i(n.status),9,Pt))),128))],64))),256))],512),[[G,j.value]])])):B("",!0),e("button",{class:"btn-dark d-block w-100 mt-5",id:"open-ticket",disabled:w.value==""||y.value==0,onClick:l[11]||(l[11]=t=>q())},"Create Ticket",8,xt)])])])])])):B("",!0)],64)}}};export{jt as default};
