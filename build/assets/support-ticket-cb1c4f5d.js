import{B as Z,f as d,b as x,d as w,e as ee,r as te,o as a,c as n,h as e,t as l,l as N,F as c,s as u,a as D,x as se,w as C,C as H,D as G,A as m,j as W,i as le}from"./app-9b2e2238.js";import{c as oe}from"./commonApis-3c849663.js";import{P as q}from"./Pagination-f75ee09a.js";import{N as ae}from"./NoPermission-e7874cbc.js";const ne={class:"dashboard"},ie={class:"container"},de={class:"d-flex justify-content-between align-items-center title-button-wrapper"},ce={class:"title mb-0"},re={key:0,class:"sub-section server-list-tab"},ue={class:"row justify-content-between align-items-center"},pe={class:"row mb-5 pe-0"},ve={class:"col-md-9 d-flex pe-0 flex-wrap"},_e={class:"sort-servers order-2 order-md-1"},me={key:0,class:"sorting-items"},he={class:"nav nav-pills mb-3 mb-md-0 order-1 order-md-2 mb-lg-0",id:"pills-tab",role:"tablist"},ge={class:"nav-item",role:"presentation"},be={class:"nav-link active",id:"pills-all-tab","data-bs-toggle":"pill","data-bs-target":"#pills-all",type:"button",role:"tab","aria-controls":"pills-all","aria-selected":"true"},fe=["id","data-bs-target","aria-controls"],ye={class:"col-md-3 text-end"},ke={class:"tab-content",id:"pills-tabContent"},$e={class:"tab-pane fade show active",id:"pills-all",role:"tabpanel","aria-labelledby":"pills-all-tab"},we={class:"row mb-5"},Ce={key:0},Te={class:"card-item p-4 mb-4 support-item flex-column"},Pe={class:"d-flex justify-content-between support-item-header"},Se={class:"support-item-title"},je=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),Ae={style:{color:"rgba(23, 30, 38, 0.5)"}},Le={class:"detail",style:{"margin-top":"10px"}},Ne={class:"detail",style:{"margin-top":"5px"}},De={class:"support-item-status"},Be={key:0,class:"successful-cell"},Ie={class:"fs-15 color-in-work"},Me={key:1,class:"cancelled-cell"},Oe={class:"fs-15 color-in-work"},Re={key:2,class:"in-progress-cell"},Ue={class:"fs-15 color-in-work"},Ve={class:"support-item-detail"},Fe=["innerHTML"],Ee={class:"w-100 server-list-pagination"},He=["id","aria-labelledby"],Ge={class:"row mb-5"},We={key:0},qe={class:"card-item p-4 mb-4 support-item flex-column"},ze={class:"d-flex justify-content-between support-item-header"},Je=["href"],Ke={class:"support-item-title"},Qe=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),Xe={style:{color:"rgba(23, 30, 38, 0.5)"}},Ye={class:"detail",style:{"margin-top":"10px"}},Ze={class:"detail",style:{"margin-top":"5px"}},xe={class:"support-item-status"},et={key:0,class:"successful-cell"},tt={class:"fs-15 color-in-work"},st={key:1,class:"cancelled-cell"},lt={class:"fs-15 color-in-work"},ot={key:2,class:"in-progress-cell"},at={class:"fs-15 color-in-work"},nt={class:"support-item-detail"},it={class:"fs-15 mb-0"},dt={class:"w-100 server-list-pagination"},ct={key:0,class:"modal modal-ticket"},rt={class:"modal-inner"},ut=e("img",{class:"close-dark",src:"assets/img/close.svg",alt:""},null,-1),pt=e("img",{class:"close-light",src:"assets/img/close-light.svg",alt:""},null,-1),vt=[ut,pt],_t={class:"modal-content"},mt={class:"modal-header"},ht={class:"modal-title"},gt={class:"modal-main"},bt={class:"amounts"},ft=["value"],yt={key:0},kt={value:"0"},$t=["value"],wt=["disabled"],v=8,At={__name:"support-ticket",setup(Ct){const B=Z.useToast(),I=oe(),h=d(!1),g=d(!1),z=x(),T=w(()=>z.state.auth.user),p=d([]),M=d([]),P=d([]),S=d([]),j=d(0),b=d(0),f=d(""),y=d(""),O=d(0),J=d(["All","Open","Answered","Customer-Reply","Closed"]),r=d({client_id:T.value.client_id,orderby:"",order:"",page:1}),K=w(()=>{const t=(r.value.page-1)*v,o=t+v;return p.value.slice(t,o)}),Q=t=>t.replace(/\n/g,"<br>"),R=()=>{m(!0),I.runGetApi("/support-ticket",r.value).then(t=>{m(!1),h.value=!1,p.value=t.data.tickets;const o=w(()=>{var s,i;return(i=(s=t==null?void 0:t.data)==null?void 0:s.status)==null?void 0:i.filter(Y=>J.value.includes(Y.title))});S.value=o.value,M.value=t.data.departments,P.value=t.data.orders;const _=t.data.totalTickets;O.value=Math.ceil(_/v)}).catch(t=>{console.log(t)})};R();function k(t){return new Date(t).toISOString().slice(0,10)}function U(t){r.value.page=t}function A(t){return`pills-${F(t)}`}function V(t){return`pills-${F(t)}-tab`}function F(t){return t.toLowerCase().replace(/ /g,"-")}const E=d([]);function L(t){const o=p.value.filter(s=>s.status===t),_=w(()=>{const s=(r.value.page-1)*v,i=s+v;return o.slice(s,i)});return E.value[t]=Math.ceil(o.length/v),_.value}function $(t,o){r.value.orderby=t,r.value.order=o,R()}const X=()=>{m(!0),I.runPostApi("/ticket-create",{subject:f.value,message:y.value,department:b.value,message:y.value,service:j.value}).then(t=>{m(!1),t.data.result=="success"?(p.value=t.data.tickets,B.success("Successfully opened ticket!"),g.value=!1):B.warning("Cannot connect to whmcs api.")}).catch(t=>{m(!1),console.log(t)})};return ee().getUser(),(t,o)=>{const _=te("router-link");return a(),n(c,null,[e("section",ne,[e("div",ie,[e("div",de,[e("h2",ce,l(t.$t("Support_Ticket")),1)]),T.value&&T.value.permissions.split(",").includes("tickets")?(a(),n("div",re,[e("div",ue,[e("div",pe,[e("div",ve,[e("div",_e,[e("div",{id:"toggleButton",class:"sort-item-active btn-chevron chevron-dark",style:{width:"160px"},onClick:o[0]||(o[0]=s=>h.value=!h.value)},[e("span",null,l(t.$t("Sort_by")),1)]),h.value?(a(),n("div",me,[e("ul",null,[e("li",{class:"touch-item",onClick:o[1]||(o[1]=s=>$("date","desc"))},l(t.$t("Opened_latest")),1),e("li",{class:"touch-item",onClick:o[2]||(o[2]=s=>$("date","asc"))},l(t.$t("Opened_oldest")),1),e("li",{class:"touch-item",onClick:o[3]||(o[3]=s=>$("lastreply","desc"))},l(t.$t("Last_Reply_latest")),1),e("li",{class:"touch-item",onClick:o[4]||(o[4]=s=>$("date","asc"))},l(t.$t("Last_Reply_oldest")),1)])])):N("",!0)]),e("ul",he,[e("li",ge,[e("button",be,l(t.$t("All")),1)]),(a(!0),n(c,null,u(S.value,s=>(a(),n("li",{key:s.title,class:"nav-item",role:"presentation"},[e("button",{id:V(s.title),class:"nav-link","data-bs-toggle":"pill","data-bs-target":"#"+A(s.title),type:"button",role:"tab","aria-controls":A(s.title),"aria-selected":!1},[s.title=="Customer-Reply"?(a(),n(c,{key:0},[W(l(t.$t("Customer_Reply")),1)],64)):(a(),n(c,{key:1},[W(l(t.$t(s.title)),1)],64))],8,fe)]))),128))])]),e("div",ye,[e("button",{type:"submit",class:"btn btn-dark hover-dark-light d-inline",id:"create-ticket",onClick:o[5]||(o[5]=s=>g.value=!0)},l(t.$t("Create_Ticket")),1)])]),e("div",ke,[e("div",$e,[e("div",we,[!p.value||p.value.length===0?(a(),n("h5",Ce,l(t.$t("No_tickets_found")),1)):(a(!0),n(c,{key:1},u(K.value,s=>(a(),n("div",{key:s.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",Te,[e("div",Pe,[D(_,{to:{name:"ticket-detail",params:{id:s.id}}},{default:le(()=>[e("div",Se,[je,e("span",Ae,l(t.$t("Ticket"))+"#"+l(s.tid),1)]),e("h3",Le,l(t.$t("Opened_at"))+" : "+l(k(s.date)),1),e("h3",Ne,l(t.$t("Last_reply_at"))+" : "+l(k(s.lastreply)),1)]),_:2},1032,["to"]),e("div",De,[s.status==="Answered"?(a(),n("div",Be,[e("span",Ie,l(t.$t(s.status)),1)])):s.status==="Closed"?(a(),n("div",Me,[e("span",Oe,l(t.$t(s.status)),1)])):(a(),n("div",Re,[e("span",Ue,l(t.$t(s.status)),1)]))])]),e("div",Ve,[e("p",{class:"fs-15 mb-0",innerHTML:Q(s.subject)},null,8,Fe)])])]))),128))]),e("div",Ee,[D(q,{currentPage:r.value.page,totalPages:O.value,onPageChanged:U},null,8,["currentPage","totalPages"])])]),(a(!0),n(c,null,u(S.value,s=>(a(),n("div",{key:s.title,class:"tab-pane fade",id:A(s.title),"aria-labelledby":V(s.title)},[e("div",Ge,[!L(s.title)||L(s.title).length===0?(a(),n("h5",We,l(t.$t("No_tickets_found")),1)):(a(!0),n(c,{key:1},u(L(s.title),i=>(a(),n("div",{key:i.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",qe,[e("div",ze,[e("a",{href:"/ticket-detail/"+i.id},[e("div",Ke,[Qe,e("span",Xe,l(t.$t("Ticket"))+"#"+l(i.tid),1)]),e("h3",Ye,l(t.$t("Opened_at"))+" : "+l(k(i.date)),1),e("h3",Ze,l(t.$t("Last_reply_at"))+" : "+l(k(i.lastreply)),1)],8,Je),e("div",xe,[i.status==="Answered"?(a(),n("div",et,[e("span",tt,l(i.status),1)])):i.status==="Closed"?(a(),n("div",st,[e("span",lt,l(i.status),1)])):(a(),n("div",ot,[e("span",at,l(i.status),1)]))])]),e("div",nt,[e("p",it,l(i.subject),1)])])]))),128))]),e("div",dt,[D(q,{currentPage:r.value.page,totalPages:E.value[s.title],onPageChanged:U},null,8,["currentPage","totalPages"])])],8,He))),128))])])])):(a(),se(ae,{key:1}))])]),g.value?(a(),n("div",ct,[e("div",rt,[e("div",{class:"modal-close",onClick:o[6]||(o[6]=s=>g.value=!1)},vt),e("div",_t,[e("div",mt,[e("div",ht,[e("h2",null,l(t.$t("New_ticket")),1),e("h3",null,l(t.$t("Create_new_ticket_now"))+".",1)])]),e("div",gt,[e("div",bt,[e("h4",null,l(t.$t("Subject")),1),C(e("input",{class:"mb-3",name:"subject",type:"text",placeholder:"Write subject","onUpdate:modelValue":o[7]||(o[7]=s=>f.value=s)},null,512),[[H,f.value]]),e("h4",null,l(t.$t("Describe_the_problem")),1),C(e("textarea",{class:"mb-3",name:"message",id:"",cols:"30",rows:"8","onUpdate:modelValue":o[8]||(o[8]=s=>y.value=s)},null,512),[[H,y.value]]),e("h4",null,l(t.$t("Department"))+"*",1),C(e("select",{name:"department",id:"department","onUpdate:modelValue":o[9]||(o[9]=s=>b.value=s)},[(a(!0),n(c,null,u(M.value,s=>(a(),n("option",{value:s.id,key:s.id},l(s.name),9,ft))),128))],512),[[G,b.value]]),P.value.length>0?(a(),n("div",yt,[e("h4",null,l(t.$t("Service_related")),1),C(e("select",{name:"service",id:"service","onUpdate:modelValue":o[10]||(o[10]=s=>j.value=s)},[e("option",kt,"- "+l(t.$t("None"))+" -",1),(a(!0),n(c,null,u(P.value,s=>(a(),n(c,null,[(a(!0),n(c,null,u(s.lineitems.lineitem,i=>(a(),n("option",{key:i.relid,value:i.relid},l(i.product)+" - "+l(i.status)+" - "+l(i.domain),9,$t))),128))],64))),256))],512),[[G,j.value]])])):N("",!0),e("button",{class:"btn-dark d-block w-100 mt-5",id:"open-ticket",disabled:f.value==""||b.value==0,onClick:o[11]||(o[11]=s=>X())},l(t.$t("Create_Ticket")),9,wt)])])])])])):N("",!0)],64)}}};export{At as default};
