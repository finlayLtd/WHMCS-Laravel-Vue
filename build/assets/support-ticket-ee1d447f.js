import{B as Q,f as d,b as X,d as $,e as Y,r as Z,o as a,c as n,h as e,t as l,l as D,F as c,s as u,a as N,x as ee,w as C,C as E,D as H,A as m,i as te}from"./app-d3a86fd1.js";import{c as se}from"./commonApis-e31faf1f.js";import{P as G}from"./Pagination-69045833.js";import{N as le}from"./NoPermission-2b0d56bb.js";const oe={class:"dashboard"},ae={class:"container"},ne={class:"d-flex justify-content-between align-items-center title-button-wrapper"},ie={class:"title mb-0"},de={key:0,class:"sub-section server-list-tab"},ce={class:"row justify-content-between align-items-center"},re={class:"row mb-5 pe-0"},ue={class:"col-md-9 d-flex pe-0 flex-wrap"},pe={class:"sort-servers order-2 order-md-1"},ve={key:0,class:"sorting-items"},_e={class:"nav nav-pills mb-3 mb-md-0 order-1 order-md-2 mb-lg-0",id:"pills-tab",role:"tablist"},me=e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"pills-all-tab","data-bs-toggle":"pill","data-bs-target":"#pills-all",type:"button",role:"tab","aria-controls":"pills-all","aria-selected":"true"},"All")],-1),he=["id","data-bs-target","aria-controls"],ge={class:"col-md-3 text-end"},be={class:"tab-content",id:"pills-tabContent"},fe={class:"tab-pane fade show active",id:"pills-all",role:"tabpanel","aria-labelledby":"pills-all-tab"},ke={class:"row mb-5"},ye={key:0},we={class:"card-item p-4 mb-4 support-item flex-column"},$e={class:"d-flex justify-content-between support-item-header"},Ce={class:"support-item-title"},Pe=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),Te={style:{color:"rgba(23, 30, 38, 0.5)"}},Se={class:"detail",style:{"margin-top":"10px"}},je={class:"detail",style:{"margin-top":"5px"}},Ae={class:"support-item-status"},Le={key:0,class:"successful-cell"},De={class:"fs-15 color-in-work"},Ne={key:1,class:"cancelled-cell"},Be={class:"fs-15 color-in-work"},Ie={key:2,class:"in-progress-cell"},Me={class:"fs-15 color-in-work"},Oe={class:"support-item-detail"},Ue=["innerHTML"],Ve={class:"w-100 server-list-pagination"},Fe=["id","aria-labelledby"],Re={class:"row mb-5"},xe={key:0},Ee={class:"card-item p-4 mb-4 support-item flex-column"},He={class:"d-flex justify-content-between support-item-header"},Ge=["href"],We={class:"support-item-title"},qe=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),ze={style:{color:"rgba(23, 30, 38, 0.5)"}},Je={class:"detail",style:{"margin-top":"10px"}},Ke={class:"detail",style:{"margin-top":"5px"}},Qe={class:"support-item-status"},Xe={key:0,class:"successful-cell"},Ye={class:"fs-15 color-in-work"},Ze={key:1,class:"cancelled-cell"},et={class:"fs-15 color-in-work"},tt={key:2,class:"in-progress-cell"},st={class:"fs-15 color-in-work"},lt={class:"support-item-detail"},ot={class:"fs-15 mb-0"},at={class:"w-100 server-list-pagination"},nt={key:0,class:"modal modal-ticket"},it={class:"modal-inner"},dt=e("img",{class:"close-dark",src:"assets/img/close.svg",alt:""},null,-1),ct=e("img",{class:"close-light",src:"assets/img/close-light.svg",alt:""},null,-1),rt=[dt,ct],ut={class:"modal-content"},pt={class:"modal-header"},vt={class:"modal-title"},_t={class:"modal-main"},mt={class:"amounts"},ht=["value"],gt={key:0},bt={value:"0"},ft=["value"],kt=["disabled"],v=8,Tt={__name:"support-ticket",setup(yt){const B=Q.useToast(),I=se(),h=d(!1),g=d(!1),W=X(),P=$(()=>W.state.auth.user),p=d([]),M=d([]),T=d([]),S=d([]),j=d(0),b=d(0),f=d(""),k=d(""),O=d(0),q=d(["All","Open","Answered","Customer-Reply","Closed"]),r=d({client_id:P.value.client_id,orderby:"",order:"",page:1}),z=$(()=>{const t=(r.value.page-1)*v,o=t+v;return p.value.slice(t,o)}),U=()=>{m(!0),I.runGetApi("/support-ticket",r.value).then(t=>{m(!1),h.value=!1,p.value=t.data.tickets;const o=$(()=>{var s,i;return(i=(s=t==null?void 0:t.data)==null?void 0:s.status)==null?void 0:i.filter(K=>q.value.includes(K.title))});S.value=o.value,M.value=t.data.departments,T.value=t.data.orders;const _=t.data.totalTickets;O.value=Math.ceil(_/v)}).catch(t=>{console.log(t)})};U();function y(t){return new Date(t).toISOString().slice(0,10)}function V(t){r.value.page=t}function A(t){return`pills-${R(t)}`}function F(t){return`pills-${R(t)}-tab`}function R(t){return t.toLowerCase().replace(/ /g,"-")}const x=d([]);function L(t){const o=p.value.filter(s=>s.status===t),_=$(()=>{const s=(r.value.page-1)*v,i=s+v;return o.slice(s,i)});return x.value[t]=Math.ceil(o.length/v),_.value}function w(t,o){r.value.orderby=t,r.value.order=o,U()}const J=()=>{m(!0),I.runPostApi("/ticket-create",{subject:f.value,message:k.value,department:b.value,message:k.value,service:j.value}).then(t=>{m(!1),t.data.result=="success"?(p.value=t.data.tickets,B.success("Successfully opened ticket!"),g.value=!1):B.warning("Cannot connect to whmcs api.")}).catch(t=>{m(!1),console.log(t)})};return Y().getUser(),(t,o)=>{const _=Z("router-link");return a(),n(c,null,[e("section",oe,[e("div",ae,[e("div",ne,[e("h2",ie,l(t.$t("Support_Ticket")),1)]),P.value&&P.value.permissions.split(",").includes("tickets")?(a(),n("div",de,[e("div",ce,[e("div",re,[e("div",ue,[e("div",pe,[e("div",{id:"toggleButton",class:"sort-item-active btn-chevron chevron-dark",style:{width:"160px"},onClick:o[0]||(o[0]=s=>h.value=!h.value)},[e("span",null,l(t.$t("Sort_by")),1)]),h.value?(a(),n("div",ve,[e("ul",null,[e("li",{class:"touch-item",onClick:o[1]||(o[1]=s=>w("date","desc"))},l(t.$t("Opened_latest")),1),e("li",{class:"touch-item",onClick:o[2]||(o[2]=s=>w("date","asc"))},l(t.$t("Opened_oldest")),1),e("li",{class:"touch-item",onClick:o[3]||(o[3]=s=>w("lastreply","desc"))},l(t.$t("Last_Reply_latest")),1),e("li",{class:"touch-item",onClick:o[4]||(o[4]=s=>w("date","asc"))},l(t.$t("Last_Reply_oldest")),1)])])):D("",!0)]),e("ul",_e,[me,(a(!0),n(c,null,u(S.value,s=>(a(),n("li",{key:s.title,class:"nav-item",role:"presentation"},[e("button",{id:F(s.title),class:"nav-link","data-bs-toggle":"pill","data-bs-target":"#"+A(s.title),type:"button",role:"tab","aria-controls":A(s.title),"aria-selected":!1},l(s.title),9,he)]))),128))])]),e("div",ge,[e("button",{type:"submit",class:"btn btn-dark hover-dark-light d-inline",id:"create-ticket",onClick:o[5]||(o[5]=s=>g.value=!0)},l(t.$t("Create_Ticket")),1)])]),e("div",be,[e("div",fe,[e("div",ke,[!p.value||p.value.length===0?(a(),n("h5",ye,l(t.$t("No_tickets_found")),1)):(a(!0),n(c,{key:1},u(z.value,s=>(a(),n("div",{key:s.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",we,[e("div",$e,[N(_,{to:{name:"ticket-detail",params:{id:s.id}}},{default:te(()=>[e("div",Ce,[Pe,e("span",Te,l(t.$t("Ticket"))+"#"+l(s.tid),1)]),e("h3",Se,l(t.$t("Opened_at"))+" : "+l(y(s.date)),1),e("h3",je,l(t.$t("Last_reply_at"))+" : "+l(y(s.lastreply)),1)]),_:2},1032,["to"]),e("div",Ae,[s.status==="Answered"?(a(),n("div",Le,[e("span",De,l(s.status),1)])):s.status==="Closed"?(a(),n("div",Ne,[e("span",Be,l(s.status),1)])):(a(),n("div",Ie,[e("span",Me,l(s.status),1)]))])]),e("div",Oe,[e("p",{class:"fs-15 mb-0",innerHTML:s.subject},null,8,Ue)])])]))),128))]),e("div",Ve,[N(G,{currentPage:r.value.page,totalPages:O.value,onPageChanged:V},null,8,["currentPage","totalPages"])])]),(a(!0),n(c,null,u(S.value,s=>(a(),n("div",{key:s.title,class:"tab-pane fade",id:A(s.title),"aria-labelledby":F(s.title)},[e("div",Re,[!L(s.title)||L(s.title).length===0?(a(),n("h5",xe,l(t.$t("No_tickets_found")),1)):(a(!0),n(c,{key:1},u(L(s.title),i=>(a(),n("div",{key:i.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",Ee,[e("div",He,[e("a",{href:"/ticket-detail/"+i.id},[e("div",We,[qe,e("span",ze,l(t.$t("Ticket"))+"#"+l(i.tid),1)]),e("h3",Je,l(t.$t("Opened_at"))+" : "+l(y(i.date)),1),e("h3",Ke,l(t.$t("Last_reply_at"))+" : "+l(y(i.lastreply)),1)],8,Ge),e("div",Qe,[i.status==="Answered"?(a(),n("div",Xe,[e("span",Ye,l(i.status),1)])):i.status==="Closed"?(a(),n("div",Ze,[e("span",et,l(i.status),1)])):(a(),n("div",tt,[e("span",st,l(i.status),1)]))])]),e("div",lt,[e("p",ot,l(i.subject),1)])])]))),128))]),e("div",at,[N(G,{currentPage:r.value.page,totalPages:x.value[s.title],onPageChanged:V},null,8,["currentPage","totalPages"])])],8,Fe))),128))])])])):(a(),ee(le,{key:1}))])]),g.value?(a(),n("div",nt,[e("div",it,[e("div",{class:"modal-close",onClick:o[6]||(o[6]=s=>g.value=!1)},rt),e("div",ut,[e("div",pt,[e("div",vt,[e("h2",null,l(t.$t("New_ticket")),1),e("h3",null,l(t.$t("Create_new_ticket_now"))+".",1)])]),e("div",_t,[e("div",mt,[e("h4",null,l(t.$t("Subject")),1),C(e("input",{class:"mb-3",name:"subject",type:"text",placeholder:"Write subject","onUpdate:modelValue":o[7]||(o[7]=s=>f.value=s)},null,512),[[E,f.value]]),e("h4",null,l(t.$t("Describe_the_problem")),1),C(e("textarea",{class:"mb-3",name:"message",id:"",cols:"30",rows:"8","onUpdate:modelValue":o[8]||(o[8]=s=>k.value=s)},null,512),[[E,k.value]]),e("h4",null,l(t.$t("Department"))+"*",1),C(e("select",{name:"department",id:"department","onUpdate:modelValue":o[9]||(o[9]=s=>b.value=s)},[(a(!0),n(c,null,u(M.value,s=>(a(),n("option",{value:s.id,key:s.id},l(s.name),9,ht))),128))],512),[[H,b.value]]),T.value.length>0?(a(),n("div",gt,[e("h4",null,l(t.$t("Service_related")),1),C(e("select",{name:"service",id:"service","onUpdate:modelValue":o[10]||(o[10]=s=>j.value=s)},[e("option",bt,"- "+l(t.$t("None"))+" -",1),(a(!0),n(c,null,u(T.value,s=>(a(),n(c,null,[(a(!0),n(c,null,u(s.lineitems.lineitem,i=>(a(),n("option",{key:i.relid,value:i.relid},l(i.product)+" - "+l(i.status),9,ft))),128))],64))),256))],512),[[H,j.value]])])):D("",!0),e("button",{class:"btn-dark d-block w-100 mt-5",id:"open-ticket",disabled:f.value==""||b.value==0,onClick:o[11]||(o[11]=s=>J())},l(t.$t("Create_Ticket")),9,kt)])])])])])):D("",!0)],64)}}};export{Tt as default};
