import{A as Q,f as d,b as X,d as $,r as Y,o as a,c as n,h as e,t as l,l as L,F as c,s as u,a as D,w as C,B as E,C as H,z as m,i as Z}from"./app-5f59d904.js";import{c as ee}from"./commonApis-4afe13c5.js";import{P as x}from"./Pagination-4fa1b581.js";const te={class:"dashboard"},se={class:"container"},le={class:"d-flex justify-content-between align-items-center title-button-wrapper"},oe={class:"title mb-0"},ae={class:"sub-section server-list-tab"},ne={class:"row justify-content-between align-items-center"},ie={class:"row mb-5 pe-0"},de={class:"col-md-9 d-flex pe-0 flex-wrap"},ce={class:"sort-servers order-2 order-md-1"},re={key:0,class:"sorting-items"},ue={class:"nav nav-pills mb-3 mb-md-0 order-1 order-md-2 mb-lg-0",id:"pills-tab",role:"tablist"},pe=e("li",{class:"nav-item",role:"presentation"},[e("button",{class:"nav-link active",id:"pills-all-tab","data-bs-toggle":"pill","data-bs-target":"#pills-all",type:"button",role:"tab","aria-controls":"pills-all","aria-selected":"true"},"All")],-1),ve=["id","data-bs-target","aria-controls"],_e={class:"col-md-3 text-end"},me={class:"tab-content",id:"pills-tabContent"},he={class:"tab-pane fade show active",id:"pills-all",role:"tabpanel","aria-labelledby":"pills-all-tab"},ge={class:"row mb-5"},be={key:0},fe={class:"card-item p-4 mb-4 support-item flex-column"},ye={class:"d-flex justify-content-between support-item-header"},ke={class:"support-item-title"},we=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),$e={style:{color:"rgba(23, 30, 38, 0.5)"}},Ce={class:"detail",style:{"margin-top":"10px"}},Pe={class:"detail",style:{"margin-top":"5px"}},Te={class:"support-item-status"},Se={key:0,class:"successful-cell"},je={class:"fs-15 color-in-work"},Ae={key:1,class:"cancelled-cell"},Le={class:"fs-15 color-in-work"},De={key:2,class:"in-progress-cell"},Be={class:"fs-15 color-in-work"},Ie={class:"support-item-detail"},Me=["innerHTML"],Ne={class:"w-100 server-list-pagination"},Oe=["id","aria-labelledby"],Ue={class:"row mb-5"},Ve={key:0},Fe={class:"card-item p-4 mb-4 support-item flex-column"},Re={class:"d-flex justify-content-between support-item-header"},Ee=["href"],He={class:"support-item-title"},xe=e("img",{class:"me-2",src:"assets/img/support.svg",alt:""},null,-1),ze={style:{color:"rgba(23, 30, 38, 0.5)"}},Ge={class:"detail",style:{"margin-top":"10px"}},We={class:"detail",style:{"margin-top":"5px"}},qe={class:"support-item-status"},Je={key:0,class:"successful-cell"},Ke={class:"fs-15 color-in-work"},Qe={key:1,class:"cancelled-cell"},Xe={class:"fs-15 color-in-work"},Ye={key:2,class:"in-progress-cell"},Ze={class:"fs-15 color-in-work"},et={class:"support-item-detail"},tt={class:"fs-15 mb-0"},st={class:"w-100 server-list-pagination"},lt={key:0,class:"modal modal-ticket"},ot={class:"modal-inner"},at=e("img",{class:"close-dark",src:"assets/img/close.svg",alt:""},null,-1),nt=e("img",{class:"close-light",src:"assets/img/close-light.svg",alt:""},null,-1),it=[at,nt],dt={class:"modal-content"},ct={class:"modal-header"},rt={class:"modal-title"},ut={class:"modal-main"},pt={class:"amounts"},vt=["value"],_t={key:0},mt={value:"0"},ht=["value"],gt=["disabled"],v=8,wt={__name:"support-ticket",setup(bt){const B=Q.useToast(),I=ee(),h=d(!1),g=d(!1),z=X(),G=$(()=>z.state.auth.user),p=d([]),M=d([]),P=d([]),T=d([]),S=d(0),b=d(0),f=d(""),y=d(""),N=d(0),W=d(["All","Open","Answered","Customer-Reply","Closed"]),r=d({client_id:G.value.client_id,orderby:"",order:"",page:1}),q=$(()=>{const t=(r.value.page-1)*v,o=t+v;return p.value.slice(t,o)}),O=()=>{m(!0),I.runGetApi("/support-ticket",r.value).then(t=>{m(!1),h.value=!1,p.value=t.data.tickets;const o=$(()=>{var s,i;return(i=(s=t==null?void 0:t.data)==null?void 0:s.status)==null?void 0:i.filter(K=>W.value.includes(K.title))});T.value=o.value,M.value=t.data.departments,P.value=t.data.orders;const _=t.data.totalTickets;N.value=Math.ceil(_/v)}).catch(t=>{console.log(t)})};O();function k(t){return new Date(t).toISOString().slice(0,10)}function U(t){r.value.page=t}function j(t){return`pills-${F(t)}`}function V(t){return`pills-${F(t)}-tab`}function F(t){return t.toLowerCase().replace(/ /g,"-")}const R=d([]);function A(t){const o=p.value.filter(s=>s.status===t),_=$(()=>{const s=(r.value.page-1)*v,i=s+v;return o.slice(s,i)});return R.value[t]=Math.ceil(o.length/v),_.value}function w(t,o){r.value.orderby=t,r.value.order=o,O()}const J=()=>{m(!0),I.runPostApi("/ticket-create",{subject:f.value,message:y.value,department:b.value,message:y.value,service:S.value}).then(t=>{m(!1),t.data.result=="success"?(p.value=t.data.tickets,B.success("Successfully opened ticket!"),g.value=!1):B.warning("Cannot connect to whmcs api.")}).catch(t=>{m(!1),console.log(t)})};return(t,o)=>{const _=Y("router-link");return a(),n(c,null,[e("section",te,[e("div",se,[e("div",le,[e("h2",oe,l(t.$t("Support_Ticket")),1)]),e("div",ae,[e("div",ne,[e("div",ie,[e("div",de,[e("div",ce,[e("div",{id:"toggleButton",class:"sort-item-active btn-chevron chevron-dark",style:{width:"160px"},onClick:o[0]||(o[0]=s=>h.value=!h.value)},[e("span",null,l(t.$t("Sort_by")),1)]),h.value?(a(),n("div",re,[e("ul",null,[e("li",{class:"touch-item",onClick:o[1]||(o[1]=s=>w("date","desc"))},l(t.$t("Opened_latest")),1),e("li",{class:"touch-item",onClick:o[2]||(o[2]=s=>w("date","asc"))},l(t.$t("Opened_oldest")),1),e("li",{class:"touch-item",onClick:o[3]||(o[3]=s=>w("lastreply","desc"))},l(t.$t("Last_Reply_latest")),1),e("li",{class:"touch-item",onClick:o[4]||(o[4]=s=>w("date","asc"))},l(t.$t("Last_Reply_oldest")),1)])])):L("",!0)]),e("ul",ue,[pe,(a(!0),n(c,null,u(T.value,s=>(a(),n("li",{key:s.title,class:"nav-item",role:"presentation"},[e("button",{id:V(s.title),class:"nav-link","data-bs-toggle":"pill","data-bs-target":"#"+j(s.title),type:"button",role:"tab","aria-controls":j(s.title),"aria-selected":!1},l(s.title),9,ve)]))),128))])]),e("div",_e,[e("button",{type:"submit",class:"btn btn-dark hover-dark-light d-inline",id:"create-ticket",onClick:o[5]||(o[5]=s=>g.value=!0)},l(t.$t("Create_Ticket")),1)])]),e("div",me,[e("div",he,[e("div",ge,[!p.value||p.value.length===0?(a(),n("h5",be,l(t.$t("No_tickets_found")),1)):(a(!0),n(c,{key:1},u(q.value,s=>(a(),n("div",{key:s.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",fe,[e("div",ye,[D(_,{to:{name:"ticket-detail",params:{id:s.id}}},{default:Z(()=>[e("div",ke,[we,e("span",$e,l(t.$t("Ticket"))+"#"+l(s.tid),1)]),e("h3",Ce,l(t.$t("Opened_at"))+" : "+l(k(s.date)),1),e("h3",Pe,l(t.$t("Last_reply_at"))+" : "+l(k(s.lastreply)),1)]),_:2},1032,["to"]),e("div",Te,[s.status==="Answered"?(a(),n("div",Se,[e("span",je,l(s.status),1)])):s.status==="Closed"?(a(),n("div",Ae,[e("span",Le,l(s.status),1)])):(a(),n("div",De,[e("span",Be,l(s.status),1)]))])]),e("div",Ie,[e("p",{class:"fs-15 mb-0",innerHTML:s.subject},null,8,Me)])])]))),128))]),e("div",Ne,[D(x,{currentPage:r.value.page,totalPages:N.value,onPageChanged:U},null,8,["currentPage","totalPages"])])]),(a(!0),n(c,null,u(T.value,s=>(a(),n("div",{key:s.title,class:"tab-pane fade",id:j(s.title),"aria-labelledby":V(s.title)},[e("div",Ue,[!A(s.title)||A(s.title).length===0?(a(),n("h5",Ve,l(t.$t("No_tickets_found")),1)):(a(!0),n(c,{key:1},u(A(s.title),i=>(a(),n("div",{key:i.id,class:"col-12 col-lg-6 col-md-6 col-sm-12"},[e("div",Fe,[e("div",Re,[e("a",{href:"/ticket-detail/"+i.id},[e("div",He,[xe,e("span",ze,l(t.$t("Ticket"))+"#"+l(i.tid),1)]),e("h3",Ge,l(t.$t("Opened_at"))+" : "+l(k(i.date)),1),e("h3",We,l(t.$t("Last_reply_at"))+" : "+l(k(i.lastreply)),1)],8,Ee),e("div",qe,[i.status==="Answered"?(a(),n("div",Je,[e("span",Ke,l(i.status),1)])):i.status==="Closed"?(a(),n("div",Qe,[e("span",Xe,l(i.status),1)])):(a(),n("div",Ye,[e("span",Ze,l(i.status),1)]))])]),e("div",et,[e("p",tt,l(i.subject),1)])])]))),128))]),e("div",st,[D(x,{currentPage:r.value.page,totalPages:R.value[s.title],onPageChanged:U},null,8,["currentPage","totalPages"])])],8,Oe))),128))])])])])]),g.value?(a(),n("div",lt,[e("div",ot,[e("div",{class:"modal-close",onClick:o[6]||(o[6]=s=>g.value=!1)},it),e("div",dt,[e("div",ct,[e("div",rt,[e("h2",null,l(t.$t("New_ticket")),1),e("h3",null,l(t.$t("Create_new_ticket_now"))+".",1)])]),e("div",ut,[e("div",pt,[e("h4",null,l(t.$t("Subject")),1),C(e("input",{class:"mb-3",name:"subject",type:"text",placeholder:"Write subject","onUpdate:modelValue":o[7]||(o[7]=s=>f.value=s)},null,512),[[E,f.value]]),e("h4",null,l(t.$t("Describe_the_problem")),1),C(e("textarea",{class:"mb-3",name:"message",id:"",cols:"30",rows:"8","onUpdate:modelValue":o[8]||(o[8]=s=>y.value=s)},null,512),[[E,y.value]]),e("h4",null,l(t.$t("Department"))+"*",1),C(e("select",{name:"department",id:"department","onUpdate:modelValue":o[9]||(o[9]=s=>b.value=s)},[(a(!0),n(c,null,u(M.value,s=>(a(),n("option",{value:s.id,key:s.id},l(s.name),9,vt))),128))],512),[[H,b.value]]),P.value.length>0?(a(),n("div",_t,[e("h4",null,l(t.$t("Service_related")),1),C(e("select",{name:"service",id:"service","onUpdate:modelValue":o[10]||(o[10]=s=>S.value=s)},[e("option",mt,"- "+l(t.$t("None"))+" -",1),(a(!0),n(c,null,u(P.value,s=>(a(),n(c,null,[(a(!0),n(c,null,u(s.lineitems.lineitem,i=>(a(),n("option",{key:i.relid,value:i.relid},l(i.product)+" - "+l(i.status),9,ht))),128))],64))),256))],512),[[H,S.value]])])):L("",!0),e("button",{class:"btn-dark d-block w-100 mt-5",id:"open-ticket",disabled:f.value==""||b.value==0,onClick:o[11]||(o[11]=s=>J())},l(t.$t("Create_Ticket")),9,gt)])])])])])):L("",!0)],64)}}};export{wt as default};
