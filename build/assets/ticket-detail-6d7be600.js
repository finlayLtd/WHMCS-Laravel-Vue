import{E as L,B as $,f as _,b as D,d as N,r as A,o as a,c as o,h as e,a as B,i as F,t as i,l as d,m as M,F as V,s as H,w as S,C as E,j as P,x as R,A as l}from"./app-77f58f2c.js";import{c as j}from"./commonApis-55ba6f04.js";import{N as q}from"./NoPermission-ae3dbda3.js";const I={class:"dashboard"},O={class:"container"},U={class:"title-button-wrapper ticket-detail"},z=e("img",{class:"status-arrow",src:"/assets/img/status-arrow.svg",alt:""},null,-1),G={key:0,class:"ticket-status-title color-in-work"},J={class:"title mb-0 mt-2"},K={key:0,class:"sub-section server-list-tab"},Q={class:"row justify-content-between align-items-center"},W={class:"row mb-5 pe-0"},X={class:"col-12"},Y={class:"card-item p-4 mb-4 support-item flex-column"},Z={key:0,class:"message-item-wrapper"},ee={key:0,class:"message-item message-received"},se={class:"message-item-header"},te={class:"message-sender"},ae={class:"fs-15"},oe={class:"message-sent-time fs-13"},ie={class:"message-content-wrapper"},ne={key:0,class:"message-body"},le=["innerHTML"],ce={key:1,class:"message-body message-attachment-body",style:{width:"fit-content"}},de=["onClick","data-lightbox"],re=e("img",{src:"/assets/img/download_icon.png",style:{width:"24px"},alt:""},null,-1),_e={class:"text-decoration-underline"},ue={key:1,class:"message-item message-sent"},me={class:"message-item-header"},he={class:"message-sender"},pe={class:"fs-15"},ge={class:"message-sent-time fs-13"},ve={class:"message-content-wrapper"},fe={key:0,class:"message-body"},ke=["innerHTML"],ye={key:1,class:"message-body message-attachment-body",style:{width:"fit-content","margin-left":"auto"}},be=["onClick","data-lightbox"],we=e("img",{src:"/assets/img/download_icon.png",style:{width:"24px"},alt:""},null,-1),xe={class:"text-decoration-underline"},Ce={class:"message-send-area-wrapper mt-4"},Te={class:"upload-attachment"},Le=e("label",{class:"file-label",for:"file"},null,-1),$e=["value"],De={class:"message-box"},Ne={key:0},Ae={key:0,id:"file-name",style:{"overflow-wrap":"anywhere"}},Be=e("span",{id:"file-name",style:{"overflow-wrap":"anywhere"}},null,-1),Fe={class:"mt-1",style:{"text-align":"right"}},Me=["disabled"],Pe={__name:"ticket-detail",setup(Ve){const h=L();$.useToast();const p=_(null),f=j(),b=D(),g=N(()=>b.state.auth.user),c=_({}),u=_(""),r=_(null),v=_("");_({client_id:g.value.client_id,orderby:"",order:""});const k=t=>t.replace(/\n/g,"<br>"),w=()=>{l(!0),f.runPostApi("/get-ticketDetails",{id:h.params.id}).then(t=>{l(!1),c.value=t.data.ticket_detail}).catch(t=>{l(!1),console.log(t)})},x=t=>{r.value=t.target.files[0],v.value=t.target.files[0].name},y=t=>{l(!0),f.runPostApi("/download-file",{id:t}).then(n=>{l(!1),n.data.result=="success"&&(p.value.href=n.data.redirect_url,p.value.click())}).catch(n=>{l(!1),console.log(n)})},C=()=>{l(!0);const t=new FormData;r.value!=null&&t.append("file",r.value),t.append("ticket_id",h.params.id),t.append("message",u.value);const n={"Content-Type":"multipart/form-data"};axios.post("/api/sendReply",t,{headers:n}).then(m=>{l(!1),c.value=m.data.ticket_detail,u.value="",r.value=null}).catch(m=>{l(!1),console.log(m)})};return w(),(t,n)=>{const m=A("router-link");return a(),o("section",I,[e("div",O,[e("a",{ref_key:"customLink",ref:p,style:{display:"none"},target:"_blank"},"Custom Link",512),e("div",U,[B(m,{to:"/support-ticket"},{default:F(()=>[z]),_:1}),c.value&&c.value.status?(a(),o("h3",G,i(t.$t(c.value.status)),1)):d("",!0),e("h2",J,i(t.$t("Ticket"))+"#"+i(M(h).params.id),1)]),g.value&&g.value.permissions.split(",").includes("tickets")?(a(),o("div",K,[e("div",Q,[e("div",W,[e("div",X,[e("div",Y,[c.value.replies?(a(),o("div",Z,[(a(!0),o(V,null,H(c.value.replies.reply,s=>(a(),o("div",{key:s.replyid,style:{"margin-bottom":"20px"}},[s.requestor_type=="Owner"?(a(),o("div",ee,[e("div",se,[e("div",te,[e("span",ae,i(s.requestor_name),1),e("span",oe,i(s.date),1)])]),e("div",ie,[s.message&&s.message!=" "?(a(),o("div",ne,[e("div",{style:{"text-align":"left"},innerHTML:k(s.message)},null,8,le)])):d("",!0),s.attachment?(a(),o("div",ce,[e("a",{class:"blackColor",onClick:T=>y(s.replyid),"data-lightbox":"image-r"+s.replyid,style:{cursor:"pointer"}},[re,e("span",_e,i(s.attachment),1)],8,de)])):d("",!0)])])):(a(),o("div",ue,[e("div",me,[e("div",he,[e("span",pe,i(s.name),1),e("span",ge,i(s.date),1)])]),e("div",ve,[s.message&&s.message!=" "?(a(),o("div",fe,[e("div",{style:{"text-align":"left"},innerHTML:k(s.message)},null,8,ke)])):d("",!0),s.attachment?(a(),o("div",ye,[e("div",null,[e("a",{class:"blackColor",onClick:T=>y(s.replyid),"data-lightbox":"image-r"+s.replyid,style:{cursor:"pointer"}},[we,e("span",xe,i(s.attachment),1)],8,be)])])):d("",!0)])]))]))),128))])):d("",!0),e("div",Ce,[e("div",Te,[Le,e("input",{name:"file",type:"file",style:{display:"none"},id:"file",onChange:x,ref:"fileInput"},null,544),e("input",{name:"ticket_id",type:"hidden",id:"ticket_id",value:c.value.id},null,8,$e)]),e("div",De,[S(e("textarea",{id:"message",name:"message",class:"p-3",cols:"30",rows:"5",placeholder:"Type messages..","onUpdate:modelValue":n[0]||(n[0]=s=>u.value=s)},null,512),[[E,u.value]]),r.value?(a(),o("div",Ne,[P(i(t.$t("File_Selected"))+": ",1),v.value!=""?(a(),o("span",Ae,i(v.value),1)):d("",!0),Be])):d("",!0)])]),e("div",Fe,[e("button",{class:"btn-dark change-profile-btn fs-15",style:{"margin-right":"0px"},onClick:n[1]||(n[1]=s=>C()),disabled:u.value==""&&r.value==null},i(t.$t("Send")),9,Me)])])])])])])):(a(),R(q,{key:1}))])])}}};export{Pe as default};
